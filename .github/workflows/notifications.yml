name: ðŸ“§ Simple Push Notifications

on:
  push:
    branches: [ main ]
  pull_request:
    types: [opened, closed, reopened]

jobs:
  notify:
    name: ðŸ“§ Send Notification
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout
      uses: actions/checkout@v4

    - name: ðŸ“§ Create GitHub Issue as Notification
      uses: actions/github-script@v7
      with:
        script: |
          const title = `ðŸ“§ Push Notification: ${context.payload.head_commit.message.substring(0, 50)}...`;
          const body = `
          ## ðŸ“‹ Repository Activity Notification
          
          **Repository:** ${context.repo.owner}/${context.repo.repo}
          **Author:** @${context.actor}
          **Branch:** ${context.ref.replace('refs/heads/', '')}
          **Commit SHA:** ${context.sha.substring(0, 7)}
          **Commit Message:** ${context.payload.head_commit.message}
          **Timestamp:** ${context.payload.head_commit.timestamp}
          
          **ðŸ”— View Changes:** https://github.com/${context.repo.owner}/${context.repo.repo}/commit/${context.sha}
          
          ---
          ðŸ“§ **Email would be sent to:** guganasfr@gmail.com
          
          *This issue is your notification. You can close it after reading.*
          `;
          
          await github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: title,
            body: body,
            labels: ['notification', 'auto-generated'],
            assignees: ['kidneykidney']
          });

    - name: ðŸ“§ Send Simple Email via curl
      run: |
        # Try to send email using a simple SMTP service
        echo "ðŸ“§ Email notification details:"
        echo "To: guganasfr@gmail.com"
        echo "Subject: ðŸš€ GitHub Push: ${{ github.repository }}"
        echo "Author: ${{ github.actor }}"
        echo "Branch: ${{ github.ref_name }}"
        echo "Commit: ${{ github.event.head_commit.message }}"
        echo "View: https://github.com/${{ github.repository }}/commit/${{ github.sha }}"

    - name: âœ… Notification Complete
      run: |
        echo "## ðŸ“§ Notification Sent" >> $GITHUB_STEP_SUMMARY
        echo "**Method:** GitHub Issue Created" >> $GITHUB_STEP_SUMMARY
        echo "**Repository:** ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
        echo "**Author:** ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
        echo "**Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "**Email Target:** guganasfr@gmail.com" >> $GITHUB_STEP_SUMMARY
